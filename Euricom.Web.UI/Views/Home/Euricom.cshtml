@{
    ViewBag.Title = "Euricom";
    Layout = "~/Views/Shared/_master.cshtml";
}

<h2>Euricom</h2>

<table id="timesheets" class="table table-striped table-hover table-condensed">   
    <thead>
        <tr>
            <th></th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Month</th>
            <th>Year</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody data-bind="foreach: viewModel.timesheets">
        <tr data-bind="attr: { 'data-row-id': id }">
            <td><input type="checkbox" data-bind="value: id"/></td>
            <td data-bind="text: firstname"></td>
            <td data-bind="text: lastname"></td>
            <td data-bind="text: formattedMonth"></td>
            <td data-bind="text: year"></td>
            <td><a href="#" class="edit" data-bind="attr: { 'data-id': id }, click: edit">Edit</a></td>
        </tr>
    </tbody>
</table>

<script type="text/javascript">
    
    function timesheet(timesheet) {
        this.id = ko.observable(timesheet.id);
        this.firstname = ko.observable(timesheet.firstname);
        this.lastname = ko.observable(timesheet.lastname);
        this.month = ko.observable(timesheet.month);
        this.year = ko.observable(timesheet.year);

        this.edit = function() {

        };


        this.formattedMonth = ko.computed(function() {
            var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return monthNames[this.month() - 1];
        }, this);

    }


    $(function() {
        ko.applyBindings(viewModel);

        viewModel.loadTimesheets();

    });

        var viewModel = {
            timesheets: ko.observableArray([]),
            
            loadTimesheets: function () {
                var self = this;
                $.getJSON(
                    '@Url.RouteUrl("DefaultApi", new { httproute = "", controller = "timesheets" })',
                function (timesheets) {
                    self.timesheets.removeAll();
                    $.each(timesheets, function (index, item) {
                        self.timesheets.push(new timesheet(item));
                    });
            }
        );
    },
        };

</script>
